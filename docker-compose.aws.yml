services:
  api-gateway:
    build:
      context: ./backend/api-gateway
      dockerfile: Dockerfile
    container_name: food-ordering-api-gateway
    ports:
      - "3000:3000"
    environment:
      GATEWAY_PORT: 3000
      RABBITMQ_URI: ${RABBITMQ_URI}
      MONGODB_URI: ${MONGODB_URI_API_GATEWAY}
      USER_SERVICE_URL: http://user-service:3003
      ORDER_SERVICE_URL: http://order-service:3001
      RESTAURANT_SERVICE_URL: http://restaurant-service:3002
      DELIVERY_SERVICE_URL: http://delivery-service:3004
      PAYMENT_SERVICE_URL: http://payment-service:3005
      FRONTEND_URL: ${FRONTEND_URL}
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
      args:
        VITE_API_GATEWAY_URL: ${VITE_API_GATEWAY_URL}
    container_name: food-ordering-frontend
    ports:
      - "5173:5173"
    depends_on:
      - api-gateway
    networks:
      - food-ordering-network
    restart: unless-stopped

  user-service:
    build:
      context: ./backend/user-service
      dockerfile: Dockerfile
    container_name: food-ordering-user-service
    environment:
      USER_SERVICE_PORT: 3003
      MONGODB_URI: ${MONGODB_URI_USER_SERVICE}
      RABBITMQ_URI: ${RABBITMQ_URI}
      JWT_SECRET: ${JWT_SECRET}
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

  order-service:
    build:
      context: ./backend/order-service
      dockerfile: Dockerfile
    container_name: food-ordering-order-service
    environment:
      ORDER_SERVICE_PORT: 3001
      MONGODB_URI: ${MONGODB_URI_ORDER_SERVICE}
      RABBITMQ_URI: ${RABBITMQ_URI}
      ORDER_QUEUE: order_queue
      PAYMENT_QUEUE: payment_queue
      DELIVERY_QUEUE: delivery_queue
      PAYMENT_SERVICE_URL: http://payment-service:3005
      USER_SERVICE_URL: http://user-service:3003
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

  restaurant-service:
    build:
      context: ./backend/restaurant-service
      dockerfile: Dockerfile
    container_name: food-ordering-restaurant-service
    environment:
      RESTAURANT_SERVICE_PORT: 3002
      MONGODB_URI: ${MONGODB_URI_RESTAURANT_SERVICE}
      RABBITMQ_URI: ${RABBITMQ_URI}
      RESTAURANT_QUEUE: restaurant_queue
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

  delivery-service:
    build:
      context: ./backend/delivery-service
      dockerfile: Dockerfile
    container_name: food-ordering-delivery-service
    environment:
      DELIVERY_SERVICE_PORT: 3004
      MONGODB_URI: ${MONGODB_URI_DELIVERY_SERVICE}
      RABBITMQ_URI: ${RABBITMQ_URI}
      DELIVERY_QUEUE: delivery_queue
      ORDER_QUEUE: order_queue
      ORDER_SERVICE_URL: http://order-service:3001
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

  payment-service:
    build:
      context: ./backend/payment-service
      dockerfile: Dockerfile
    container_name: food-ordering-payment-service
    environment:
      PAYMENT_SERVICE_PORT: 3005
      MONGODB_URI: ${MONGODB_URI_PAYMENT_SERVICE}
      RABBITMQ_URI: ${RABBITMQ_URI}
      PAYMENT_QUEUE: payment_queue
      ORDER_QUEUE: order_queue
      SEPAY_ACCOUNT_ID: ${SEPAY_ACCOUNT_ID}
      SEPAY_API_KEY: ${SEPAY_API_KEY}
      SEPAY_API_SECRET: ${SEPAY_API_SECRET}
      SEPAY_ACCOUNT_NUMBER: ${SEPAY_ACCOUNT_NUMBER}
      SEPAY_BANK_NAME: ${SEPAY_BANK_NAME}
      SEPAY_BANK_CODE: ${SEPAY_BANK_CODE}
      PAYMENT_CALLBACK_URL: ${PAYMENT_CALLBACK_URL}
      FRONTEND_URL: ${FRONTEND_URL}
      NODE_ENV: production
    networks:
      - food-ordering-network
    restart: unless-stopped

networks:
  food-ordering-network:
    driver: bridge
